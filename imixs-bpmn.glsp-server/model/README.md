# BPMN 2.0 ecore

The *bpmn-graph.ecore* file defines the graphical model of BPMN 2.0 used in Open BPMN. The adapted node and edge elements within this model are designed to meet the requirements for the graphical modeling of a BPMN diagram. This includes the *Common Executable Conformance Sub-Class*. This conformance sub-class is intended for modeling tools that can emit executable models, which is the main purpose of Open BPMN. More details can be found in the [BPMN 2.0.2 specification](https://www.omg.org/spec/BPMN).



The bpmn-graph.ecore file includes of the following diagram elements:

 - Task types, 
 - CallActivity,
 - all Gateway types, 
 - all Event types (Start, Intermediate, and End), 
 - Lane, 
 - Participants, 
 - Data Object 
 - Message, 
 - Group, 
 - Text
 - Annotation, 
 - Sequence Flow (including conditional and default flows),
 - Message Flow
 
## Visual Appearance - GLSP

A key element of BPMN is the choice of shapes and icons used for the graphical elements identified in this International
Standard. The intent is to create a standard visual language that all process modelers will recognize and understand. Open BPMN uses the graphical elements, shapes, and markers illustrated in the BPMN 2.0 standard.

The graphical model is based on the [GLSP modeling concept](https://www.eclipse.org/glsp/) and did not contain all properties from the BPMN 2.0.2 specification. But the Open BPMN model Server can deal with all aspects of BPMN 2.0 and translates a .bpmn file into a GLSP model and vice versa. 



## Build the Open BPMN EMF Model

Open-BPMN provides a EMF model for the BPMN 2.0 standard (work in progress). The model is located in `/model/bpmn-graph.ecore`. The model file extends the  GLSP model schema. 

The interfaces and classes can be generated by the [Eclipse Modeling Framework](https://www.eclipse.org/modeling/emf/). Eclipse will create the necessary java classes out of the EMF model description. To create the model follow these steps:

 - Create or update the EMF Model file `bpmn.ecore`
 - Generate a `bpmn.genmodel` file
 - Generate Java Classes based on your .genmodel file

### Create a new EMF model

you can change or update the existing bpmn.ecore file using the [Eclipse Modeling Framework](https://www.eclipse.org/modeling/emf/).

In EMF Model File you typically extend the GLSP super types. See the following example defining a 'Task' element

	<?xml version="1.0" encoding="UTF-8"?>
	<ecore:EPackage xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xmlns:ecore="http://www.eclipse.org/emf/2002/Ecore" name="wfgraph" nsURI="http://www.imixs.org/bpmn/glsp/graph"
	    nsPrefix="bpmngraph">
	  <eClassifiers xsi:type="ecore:EClass" name="ActivityNode" eSuperTypes="glsp-graph.ecore#//GNode">
	    <eStructuralFeatures xsi:type="ecore:EAttribute" name="nodeType" eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/>
	    <eStructuralFeatures xsi:type="ecore:EAttribute" name="name" eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/>
	  </eClassifiers>
	 
	  <eClassifiers xsi:type="ecore:EClass" name="Icon" eSuperTypes="glsp-graph.ecore#//GCompartment"/>
	
	</ecore:EPackage>	


**Note:** Take care about the nsURI and nsPrefix which will be part of the generated interface definitions. 


### Create a .genmodel file

After the EMF file is defined you can need to recreate the genmodel file. Choose from the Eclipse IDE context menu of the bpmn.ecore file:

‘New->Other->EMF Generator Model’

and create a new file ‘bpmn.genmodel’. Choose the importer ‘ecoremodel’. 

<img src="./doc/emf-generator-01.png" />

Click on load will verify the EMF model file created before.

Next select both packages in the 'Package Selection' (the glsp-graph package includes the core elements form the GLSP project)

<img src="./doc/emf-generator-02.png" />

Click on 'Finish' to generate the *.genmodel* file.

### Generate java classes

Now you can generate the java classes. Before you can start, you need to change some of the details of the new *.genfile*.  Open the *.genfile* and choose the root element of the bpmnGraph. In the property view change the package name into `org.imixs.bpmn`:

<img src="./doc/emf-generator-03.png" />

Next choose the root element of you glsp graph model. In the property view change the package name to `org.eclipse.glsp`. 

<img src="./doc/emf-generator-04.png" />

Click on the root element of the genfile and choose ‘Generate Model Code’. This will create the class files in the predefined package. 

Change the tag `modelDirectory` to `/imixs-bpmn.glsp-server/src/main/java-gen` - this will be the source location for the files


Finally you can now generate the code of your model. Select again only the root element of your model and Choose *Generate Model Code*. This will now generate all necessary classes referencing the GLSP core model types. 




